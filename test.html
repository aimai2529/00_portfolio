<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>スライドショー＋進行バー</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
        }

        .slideshow {
            width: 400px;
            height: 300px;
            margin: auto;
            background-size: cover;
            background-position: center;
        }

        .progress-bar {
            display: flex;
            width: 400px;
            height: 10px;
            margin: 10px auto;
            background: #ddd;
        }

        .segment {
            flex: 1;
            margin: 0 2px;
            background: #ccc;
            position: relative;
            overflow: hidden;
        }

        .fill {
            height: 100%;
            background: #4caf50;
            width: 0%;
            transition: width 5s linear;
        }

        button {
            margin-top: 10px;
            padding: 6px 16px;
        }
    </style>
</head>

<body>

    <div id="slideshow" class="slideshow"></div>

    <div class="progress-bar" id="progressBar">
        <div class="segment">
            <div class="fill"></div>
        </div>
        <div class="segment">
            <div class="fill"></div>
        </div>
        <div class="segment">
            <div class="fill"></div>
        </div>
        <div class="segment">
            <div class="fill"></div>
        </div>
    </div>

    <button id="toggleBtn">停止</button>

    <script>
        const images = [
            "https://via.placeholder.com/400x300/ff7f7f/333?text=1",
            "https://via.placeholder.com/400x300/7fbfff/333?text=2",
            "https://via.placeholder.com/400x300/ffff7f/333?text=3",
            "https://via.placeholder.com/400x300/7fff7f/333?text=4"
        ];

        let currentIndex = 0;
        let intervalId;
        let isRunning = true;
        const slideshow = document.getElementById("slideshow");
        const fills = document.querySelectorAll(".fill");
        const button = document.getElementById("toggleBtn");

        function showSlide(index) {
            slideshow.style.backgroundImage = `url(${images[index]})`;
            fills.forEach((fill, i) => {
                fill.style.width = (i < index) ? "100%" : "0%";
                fill.style.transition = "none"; // 一度リセット
            });

            // 現在の部分だけ進行アニメーション
            setTimeout(() => {
                if (isRunning) {
                    fills[index].style.transition = "width 5s linear";
                    fills[index].style.width = "100%";
                }
            }, 50);
        }

        function startSlideshow() {
            showSlide(currentIndex);
            intervalId = setInterval(() => {
                currentIndex = (currentIndex + 1) % images.length;
                showSlide(currentIndex);
            }, 5000);
        }

        button.addEventListener("click", () => {
            if (isRunning) {
                clearInterval(intervalId);
                isRunning = false;
                button.textContent = "再開";
                // transition を止めて width を保つ
                fills.forEach(fill => {
                    const computed = window.getComputedStyle(fill);
                    fill.style.transition = "none";
                    fill.style.width = computed.width;
                });
            } else {
                isRunning = true;
                button.textContent = "停止";
                showSlide(currentIndex); // 再開時にアニメーション再設定
                intervalId = setInterval(() => {
                    currentIndex = (currentIndex + 1) % images.length;
                    showSlide(currentIndex);
                }, 5000);
            }
        });

        startSlideshow();
    </script>
</body>

</html>